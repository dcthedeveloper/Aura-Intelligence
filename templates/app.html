<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Intelligence - Fragrance Description Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@500;600;700&display=swap');
        
        :root {
            /* Minimal Luxury Champagne Palette */
            --primary: #C9B896;        /* Champagne Gold - Primary brand color */
            --primary-dark: #B5A585;   /* Darker Champagne - Hover states */
            --primary-darker: #A18F71; /* Even Darker - Active states */
            --accent-light: #E8E0D5;   /* Champagne Tint - Accents */
            
            --stone-50: #FEFEFE;            /* Background */
            --stone-100: #F8F8F7;           /* Cards, elevated surfaces */
            --stone-200: #E8E8E6;           /* Borders, dividers */
            --stone-300: #d6d3d1;           /* Disabled states */
            --stone-600: #6B6B6B;           /* Secondary text */
            --stone-800: #1A1A1A;           /* Body text */
            --stone-900: #1A1A1A;           /* Headings, primary text */
            
            --success: #16a34a;             /* Green-600 - Success states */
            --error: #dc2626;               /* Red-600 - Errors */
            --warning: #ea580c;             /* Orange-600 - Warnings */
            
            /* Legacy variables for gradual migration */
            --cream: #fafaf9;
            --dark: #1c1917;
            --light-gray: #e7e5e4;
            --gold: #C9B896;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--stone-50);
            color: var(--stone-800);
        }

        /* Gradient text utility - matches landing page */
        .gradient-text {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            letter-spacing: 0.08em;
            color: var(--stone-900);
        }

        .main-container {
            width: 100%;
            max-width: 48rem; /* Slightly wider for chat */
            margin: 0 auto;
        }
        
        textarea.input-field {
            resize: none;
        }
        
        .form-section { 
            display: none;
            animation: fadeInUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .form-section.active { 
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(25px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #chat-wrapper {
            animation: fadeInUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        /* Chat bubbles - Improved contrast and hierarchy */
        .chat-history {
            height: 60vh;
            overflow-y: auto;
            padding: 1rem;
            border: 1px solid var(--stone-200);
            border-radius: 0.5rem;
            background-color: var(--stone-50);
            display: flex;
            flex-direction: column;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 0.75rem 1.25rem;
            border-radius: 1.25rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        .chat-bubble.user {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border-bottom-right-radius: 0.25rem;
            align-self: flex-end;
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.2);
        }
        .chat-bubble.ai {
            background-color: white;
            color: var(--stone-800);
            border-bottom-left-radius: 0.25rem;
            align-self: flex-start;
            border: 1px solid var(--stone-200);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .chat-bubble.ai strong { 
            color: var(--primary); 
        }
        .chat-bubble.ai a { 
            color: var(--primary); 
            text-decoration: underline; 
        }
        .chat-bubble.ai a:hover {
            color: var(--primary-dark);
        }

        /* Suggestion chips - Gold accent on hover */
        .suggestion-chip {
            border: 1.5px solid var(--stone-200);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            background-color: white;
            color: var(--stone-700);
        }
        .suggestion-chip:hover {
            background-color: rgba(217, 119, 6, 0.1);
            border-color: var(--primary);
            color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
        }
        
        /* Mode toggle - Enhanced active states */
        .mode-toggle-group button {
            border: 1.5px solid var(--stone-300);
            color: var(--stone-600);
            padding: 0.6rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background-color: white;
        }
        .mode-toggle-group button:hover:not(.active) {
            background-color: var(--stone-50);
            border-color: var(--stone-400);
            color: var(--stone-800);
        }
        .mode-toggle-group button.active {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.2);
        }
        .mode-toggle-group button:first-child { border-radius: 9999px 0 0 9999px; }
        .mode-toggle-group button:last-child { border-radius: 0 9999px 9999px 0; }

        /* Radio groups - Gold accent when selected */
        .radio-group label {
            border: 1.5px solid var(--stone-200);
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            background-color: white;
        }
        .radio-group label:hover {
            border-color: var(--primary);
            background-color: rgba(217, 119, 6, 0.05);
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group input[type="radio"]:checked + label {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.2);
        }

        select.input-field {
            padding-right: 2.5rem;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Input fields - Improved focus states and accessibility */
        .input-field { 
            background-color: transparent; 
            border: none; 
            border-bottom: 1.5px solid var(--stone-200); 
            border-radius: 0; 
            padding: 0.875rem 0.5rem; 
            font-size: 0.95rem; 
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            color: var(--stone-900);
        }
        .input-field::placeholder { 
            color: var(--stone-600); 
            font-weight: 400; 
        }
        .input-field:focus { 
            border-color: var(--primary); 
            box-shadow: 0 2px 0 0 rgba(217, 119, 6, 0.2); 
            outline: none; 
            transform: translateY(-2px); 
            background-color: rgba(250, 250, 249, 0.8); 
        }
        .input-field:hover:not(:focus) {
            border-color: var(--stone-300);
        }
        /* Button System - Improved hierarchy */
        .btn { 
            transition: all 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            border: 1px solid transparent; 
            font-weight: 500; 
            font-size: 0.9rem; 
            letter-spacing: 0.03em; 
            border-radius: 9999px; 
            position: relative; 
            overflow: hidden;
            cursor: pointer;
        }
        
        /* Primary gold button */
        .btn-gold { 
            background: linear-gradient(to right, var(--primary), var(--primary-dark)); 
            color: white; 
            box-shadow: 0 3px 10px rgba(217, 119, 6, 0.2); 
        }
        .btn-gold:hover:not(:disabled) { 
            background: linear-gradient(to right, var(--primary-dark), var(--primary-darker)); 
            transform: translateY(-3px); 
            box-shadow: 0 10px 20px rgba(217, 119, 6, 0.3); 
        }
        .btn-gold:active:not(:disabled) { 
            transform: translateY(-1px); 
            box-shadow: 0 5px 12px rgba(217, 119, 6, 0.25); 
        }
        .btn-gold:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none; 
        }
        
        /* Outline button */
        .btn-outline { 
            border: 1.5px solid var(--stone-300); 
            color: var(--stone-800); 
            background: transparent; 
        }
        .btn-outline:hover:not(:disabled) { 
            background-color: var(--stone-100); 
            border-color: var(--primary); 
            color: var(--primary); 
        }
        
        /* Secondary dark button */
        .btn-dark { 
            background-color: var(--stone-900); 
            color: white; 
            box-shadow: 0 3px 10px rgba(28, 25, 23, 0.15); 
        }
        .btn-dark:hover:not(:disabled) { 
            background-color: var(--stone-800); 
            transform: translateY(-2px); 
            box-shadow: 0 8px 16px rgba(28, 25, 23, 0.2); 
        }
        .btn-outline { background-color: transparent; color: var(--dark); border-color: #d5cfc3; }
        .btn-outline:hover:not(:disabled) { background-color: #f1ece2; border-color: #b8b2a6; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.06); }
        .progress-bar-container { width: 100%; background-color: #e8e2d6; border-radius: 9999px; height: 2px; margin-bottom: 2.5rem; overflow: hidden; }
        .progress-bar-fill { transition: width 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94); background: linear-gradient(90deg, var(--dark) 0%, #404040 100%); height: 100%; }
        .output-card { background: linear-gradient(135deg, #FAF6F0 0%, #F8F4ED 100%); border: 1px solid #E5DED0; border-radius: 0.75rem; padding: 2rem; margin-bottom: 1.75rem; animation: slideInCard 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; opacity: 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03); }
        @keyframes slideInCard { from { opacity: 0; transform: translateY(35px); } to { opacity: 1; transform: translateY(0); } }
        .prose-custom h3 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.75rem; } .prose-custom p { line-height: 1.8; margin-bottom: 0.875rem; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e8e2d6; }
        @keyframes spin { to { transform: rotate(360deg); } } .animate-spin { animation: spin 1.2s linear infinite; }
    </style>
</head>
<body class="bg-white">

    <!-- Navigation (same as home.html) -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center h-10">
                <a href="/" class="text-2xl font-serif font-bold">
                    <span style="background: linear-gradient(135deg, #C9B896 0%, #B5A585 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Aura</span> Intelligence
                </a>
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="/how-it-works" class="text-gray-600 hover:text-gray-900 transition">How It Works</a>
                    <a href="/use-cases" class="text-gray-600 hover:text-gray-900 transition">Use Cases</a>
                    <a href="/features" class="text-gray-600 hover:text-gray-900 transition">Features</a>
                    <a href="/science" class="text-gray-600 hover:text-champagne-500 transition">Science</a>
                    <a href="/lab" class="text-gray-600 hover:text-champagne-500 transition">AI Lab</a>
                    <a href="/" class="text-gray-600 hover:text-gray-900 transition">← Back to Home</a>
                </div>
                <!-- Mobile menu button -->
                <button id="mobile-menu-btn" class="md:hidden text-gray-900">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <!-- Mobile menu -->
            <div id="mobile-menu" class="hidden md:hidden pt-4 pb-2 space-y-2">
                <a href="/how-it-works" class="block text-gray-600 hover:text-gray-900 py-2">How It Works</a>
                <a href="/use-cases" class="block text-gray-600 hover:text-gray-900 py-2">Use Cases</a>
                <a href="/features" class="block text-gray-600 hover:text-gray-900 py-2">Features</a>
                <a href="/science" class="block text-gray-600 hover:text-gray-900 py-2">Science</a>
                <a href="/lab" class="block text-gray-600 hover:text-gray-900 py-2">AI Lab</a>
                <a href="/" class="block text-gray-600 hover:text-gray-900 py-2">← Back to Home</a>
            </div>
        </div>
    </nav>

    <div class="flex flex-col items-center min-h-screen p-4 md:p-8">

    <div class="main-container">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-semibold">
                <span style="background: linear-gradient(135deg, #C9B896 0%, #B5A585 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Aura</span> Intelligence
            </h1>
            <p class="text-lg mt-2" style="letter-spacing: 0.05em; color: #78716c;">Your Olfactory Storyteller & Curator</p>
        </header>

        <div class="flex justify-center mb-8">
            <div class="mode-toggle-group inline-flex" role="group">
                <button type="button" id="mode-storyteller" class="active">Storyteller</button>
                <button type="button" id="mode-curator">Curator</button>
            </div>
        </div>

        <div id="storyteller-wrapper">
             <form id="generator-form">
                <div class="progress-bar-container"><div id="progress-bar" class="progress-bar-fill" style="width: 0%"></div></div>
                <div id="step-1" class="form-section active">
                    <h2 class="text-2xl font-semibold mb-1">The Fragrance <span class="text-base text-gray-500 font-medium">(1 of 4)</span></h2>
                    <p class="text-sm text-gray-500 mb-6">Start with the scent's core components.</p>
                    <div class="radio-group flex items-center space-x-4 mb-6">
                        <input type="radio" id="use-case-existing" name="use_case" value="existing" checked><label for="use-case-existing">An Existing Fragrance</label>
                        <input type="radio" id="use-case-new" name="use_case" value="new"><label for="use-case-new">A New Creation</label>
                    </div>
                    
                    <!-- Browse Collections Button -->
                    <div class="mb-6">
                        <button type="button" id="browse-collections-btn" class="btn btn-outline w-full py-3 text-sm">
                            Browse Collections
                        </button>
                        <p class="text-xs text-gray-500 text-center mt-2">Need inspiration? Explore our curated niche fragrances</p>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6">
                        <input type="text" name="product_name" class="w-full input-field" placeholder="Fragrance Name (e.g., Creed Virgin Island Water)">
                        <textarea name="key_notes" rows="4" class="w-full input-field" placeholder="Key Olfactory Notes (Top, Heart, Base)"></textarea>
                    </div>
                </div>
                <div id="step-2" class="form-section">
                    <h2 class="text-2xl font-semibold mb-1">The Aura <span class="text-base text-gray-500 font-medium">(2 of 4)</span></h2>
                     <p class="text-sm text-gray-500 mb-6">Define the fragrance's soul.</p>
                    <div class="grid grid-cols-1 gap-6">
                       <input type="text" name="vibe_keywords" class="w-full input-field" placeholder="Desired Vibe (e.g., Tropical luxury)">
                       <input type="text" name="target_audience" class="w-full input-field" placeholder="Wearer's Persona (e.g., World traveler)">
                    </div>
                </div>
                <div id="step-3" class="form-section">
                     <h2 class="text-2xl font-semibold mb-1">The Narrative <span class="text-base text-gray-500 font-medium">(3 of 4)</span></h2>
                     <p class="text-sm text-gray-500 mb-6">Craft the olfactory journey.</p>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-8">
                        <input type="text" name="storytelling_angle" class="w-full input-field" placeholder="Narrative Scene (e.g., A sunset sail)">
                        <div class="relative">
                            <label class="block text-xs font-medium text-gray-600 mb-2">Writing Tone & Style</label>
                            <select name="tone" id="tone-select" class="w-full input-field tone-selector" style="padding-top: 0.875rem; padding-bottom: 0.875rem;">
                                <option value="Poetic & Evocative" data-preview="Velvet dusk unfolds across skin like a whispered secret..." data-use="Luxury brands, editorial content">Poetic & Evocative</option>
                                <option value="Modern & Direct" data-preview="Clean bergamot meets warm amber. Fresh, confident, unforgettable." data-use="E-commerce, Shopify listings">Modern & Direct</option>
                                <option value="Minimalist & Clean" data-preview="Bergamot. Sandalwood. Nothing else. Everything." data-use="Scandinavian brands, indie perfumers">Minimalist & Clean</option>
                                <option value="Mysterious & Dark" data-preview="Shadows gather where skin meets scent, a secret whispered in smoke and spice." data-use="Niche brands, artistic launches">Mysterious & Dark</option>
                                <option value="Playful & Energetic" data-preview="Pop! Citrus bursts like sunshine on a Monday morning—happy, bright, impossible to ignore." data-use="Youth market, fun brands">Playful & Energetic</option>
                                <option value="Sultry & Sensual" data-preview="Heat rises. Amber and vanilla melt into skin, intimate and intoxicating." data-use="Date night, romantic fragrances">Sultry & Sensual</option>
                                <option value="Professional & Refined" data-preview="Sophisticated notes of vetiver and citrus command attention without asking for it." data-use="Office scents, corporate gifting">Professional & Refined</option>
                                <option value="Classic & Timeless" data-preview="Elegance never fades. This is the scent of legacy, refined through generations." data-use="Heritage brands, traditional perfumery">Classic & Timeless</option>
                            </select>
                            <!-- Tone Preview Tooltip -->
                            <div id="tone-preview" class="hidden absolute z-10 w-full mt-2 p-4 rounded-lg border-2 shadow-lg" style="background-color: var(--cream); border-color: var(--gold);">
                                <p class="text-xs italic text-gray-700 mb-2" id="tone-preview-text">Preview will appear here...</p>
                                <p class="text-xs font-semibold" style="color: var(--gold);">
                                    <span>Best for: </span><span id="tone-preview-use">-</span>
                                </p>
                            </div>
                        </div>
                     </div>
                </div>
                <div id="step-4" class="form-section">
                     <h2 class="text-2xl font-semibold mb-1">The Edge <span class="text-base text-gray-500 font-medium">(4 of 4)</span></h2>
                     <p class="text-sm text-gray-500 mb-6">Provide strategic inputs & choose output style.</p>
                     <div class="grid grid-cols-1 gap-6">
                        <!-- Output Length Control -->
                        <div class="border-2 rounded-lg p-5" style="border-color: var(--gold); background-color: rgba(183, 144, 76, 0.05);">
                            <label class="block text-sm font-semibold mb-3" style="color: var(--dark);">Output Length & Style</label>
                            <div class="space-y-3">
                                <label class="flex items-start gap-3 cursor-pointer p-3 rounded-lg border-2 border-transparent hover:border-gray-300 transition-all">
                                    <input type="radio" name="output_length" value="product" class="mt-1" checked>
                                    <div class="flex-1">
                                        <div class="font-semibold flex items-center gap-2">
                                            Product Description (300-500 words)
                                            <span class="text-xs px-2 py-0.5 rounded-full" style="background-color: var(--gold); color: white;">⭐ Recommended</span>
                                        </div>
                                        <p class="text-xs text-gray-600 mt-1">SEO-optimized for e-commerce with structured headings & bullet points</p>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 cursor-pointer p-3 rounded-lg border-2 border-transparent hover:border-gray-300 transition-all">
                                    <input type="radio" name="output_length" value="full" class="mt-1">
                                    <div class="flex-1">
                                        <div class="font-semibold">Full Story (800-1200 words)</div>
                                        <p class="text-xs text-gray-600 mt-1">Immersive narrative for brand storytelling, lookbooks & editorial content</p>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 cursor-pointer p-3 rounded-lg border-2 border-transparent hover:border-gray-300 transition-all">
                                    <input type="radio" name="output_length" value="short" class="mt-1">
                                    <div class="flex-1">
                                        <div class="font-semibold">Short Form (150-200 words)</div>
                                        <p class="text-xs text-gray-600 mt-1">Concise copy for social media, ads & quick product highlights</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <textarea name="competitor_text" rows="4" class="w-full input-field" placeholder="Competitor's Story (Optional)"></textarea>
                        <input type="text" name="seo_keywords" class="w-full input-field" placeholder="Target SEO Keywords (Optional)">
                     </div>
                </div>
                <div class="mt-10 flex justify-between items-center">
                    <button type="button" id="prev-btn" class="btn btn-outline py-2.5 px-7 rounded-full" disabled>Previous</button>
                    <button type="button" id="next-btn" class="btn btn-gold py-2.5 px-7 rounded-full">Next</button>
                    <button type="submit" id="generate-btn" class="hidden btn btn-gold font-bold py-2.5 px-7 rounded-full inline-flex items-center">
                        <svg id="spinner" class="animate-spin -ml-1 mr-2 h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        <span id="generate-btn-text">Craft Story</span>
                    </button>
                </div>
            </form>
        </div>

        <div id="curator-wrapper" class="hidden">
            <div id="chat-wrapper">
                <div class="chat-history" id="chat-history">
                    <div class="chat-bubble ai">
                        <p>Hello! I'm Aura, your personal fragrance curator. 👋</p>
                        <p>I can help you discover your next signature scent, recommend fragrances for specific occasions, or answer questions about perfumery. What brings you here today?</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <div class="flex flex-wrap gap-2 mb-4" id="suggestions">
                        <button class="suggestion-chip" data-suggestion="Recommend a fresh summer fragrance">🌊 Summer scents</button>
                        <button class="suggestion-chip" data-suggestion="What's a good date night fragrance?">💕 Date night</button>
                        <button class="suggestion-chip" data-suggestion="Suggest something woody and sophisticated">🌲 Woody scents</button>
                        <button class="suggestion-chip" data-suggestion="Tell me about Creed Aventus">🔍 Learn about a fragrance</button>
                    </div>
                    
                    <form id="chat-form" class="flex gap-2">
                        <input 
                            type="text" 
                            id="chat-input" 
                            class="flex-1 input-field" 
                            placeholder="Ask me anything about fragrances..."
                            autocomplete="off"
                        >
                        <button type="submit" class="btn btn-gold px-6 py-3">
                            <span id="chat-send-text">Send</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div id="output-container" class="hidden">
             <div class="results-header">
                 <h2 class="text-3xl font-semibold">Your Olfactory Story</h2>
                 <div class="results-actions flex flex-wrap gap-2">
                    <button id="save-btn" class="btn btn-outline py-2 px-5 rounded-full inline-flex items-center text-sm gap-1">
                       <span>💾</span>
                       <span id="save-btn-text">Save</span>
                   </button>
                    <button id="copy-btn" class="btn btn-outline py-2 px-5 rounded-full inline-flex items-center text-sm gap-1">
                       <span id="copy-btn-icon">📋</span>
                       <span id="copy-btn-text">Copy</span>
                   </button>
                    <button id="pdf-btn" class="btn btn-outline py-2 px-5 rounded-full inline-flex items-center text-sm gap-1">
                       <span>📄</span>
                       <span id="pdf-btn-text">Export PDF</span>
                   </button>
                    <button id="social-btn" class="btn btn-outline py-2 px-5 rounded-full inline-flex items-center text-sm gap-1">
                       <span>📱</span>
                       <span>Social Posts</span>
                   </button>
                    <button id="seo-btn" class="btn btn-outline py-2 px-5 rounded-full inline-flex items-center text-sm gap-1">
                       <span>📊</span>
                       <span id="seo-btn-text">SEO Score</span>
                   </button>
                    <button id="start-over-btn" class="btn btn-gold py-2 px-5 rounded-full text-sm">Start Over</button>
                </div>
            </div>
            <div id="output-content" class="prose-custom max-w-none space-y-6"></div>
        </div>
        
        <!-- Saved Stories Modal -->
        <div id="saved-stories-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[80vh] overflow-hidden" style="background-color: var(--cream);">
                <div class="p-6 border-b border-gray-300">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-semibold" style="font-family: 'Playfair Display', serif;">Saved Stories</h3>
                        <button id="close-modal" class="text-2xl hover:text-gray-600">&times;</button>
                    </div>
                </div>
                <div id="saved-stories-list" class="p-6 overflow-y-auto max-h-[60vh]">
                    <!-- Stories will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Social Media Modal -->
        <div id="social-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg max-w-2xl w-full" style="background-color: var(--cream);">
                <div class="p-6 border-b border-gray-300">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-semibold" style="font-family: 'Playfair Display', serif;">Social Media Posts</h3>
                        <button id="close-social-modal" class="text-2xl hover:text-gray-600">&times;</button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="flex gap-2 mb-4">
                        <button class="social-platform-btn btn btn-outline py-2 px-4 text-sm active inline-flex items-center gap-2" data-platform="instagram">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                            Instagram
                        </button>
                        <button class="social-platform-btn btn btn-outline py-2 px-4 text-sm inline-flex items-center gap-2" data-platform="twitter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                            X
                        </button>
                        <button class="social-platform-btn btn btn-outline py-2 px-4 text-sm inline-flex items-center gap-2" data-platform="facebook">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                            Facebook
                        </button>
                    </div>
                    
                    <div id="social-content" class="p-4 border border-gray-300 rounded-lg bg-white bg-opacity-40 min-h-[150px]">
                        <p class="text-gray-500 text-center">Select a platform to generate post</p>
                    </div>
                    
                    <div class="mt-4 flex gap-2">
                        <button id="generate-social-btn" class="btn btn-gold py-2 px-5 flex-1">Generate Post</button>
                        <button id="copy-social-btn" class="btn btn-outline py-2 px-5 hidden">Copy Post</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SEO Analysis Modal -->
        <div id="seo-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg max-w-3xl w-full max-h-[85vh] overflow-hidden" style="background-color: var(--cream);">
                <div class="p-6 border-b border-gray-300">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-semibold" style="font-family: 'Playfair Display', serif;">SEO Analysis & Optimization</h3>
                        <button id="close-seo-modal" class="text-2xl hover:text-gray-600">&times;</button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto max-h-[70vh]">
                    <!-- SEO Score Display -->
                    <div id="seo-score-section" class="mb-6 text-center p-6 bg-white bg-opacity-40 rounded-lg border border-gray-300">
                        <div class="inline-flex items-center justify-center w-32 h-32 rounded-full border-8 mb-4" id="seo-score-circle" style="border-color: var(--gold);">
                            <div>
                                <div class="text-5xl font-bold" id="seo-score-value" style="font-family: 'Playfair Display', serif; color: var(--gold);">--</div>
                                <div class="text-sm text-gray-600">out of 100</div>
                            </div>
                        </div>
                        <p class="text-lg font-semibold mb-2" id="seo-score-label">Analyzing...</p>
                        <p class="text-sm text-gray-600" id="seo-score-desc">Please wait while we analyze your content</p>
                        
                        <!-- Word Count Badge -->
                        <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full border border-gray-300">
                            <span class="text-sm font-semibold">Word Count:</span>
                            <span id="word-count-badge" class="text-sm font-bold" style="color: var(--gold);">--</span>
                            <span class="text-xs text-gray-500">(Ideal: 300-500)</span>
                        </div>
                    </div>
                    
                    <!-- Auto-Optimize Button -->
                    <div id="optimize-section" class="mb-6 hidden">
                        <button id="auto-optimize-btn" class="btn btn-gold w-full py-3 text-sm flex items-center justify-center gap-2">
                            <span>✨</span>
                            <span id="optimize-btn-text">Auto-Optimize for SEO</span>
                        </button>
                        <p class="text-xs text-gray-600 text-center mt-2">Automatically restructure content to 300-500 words with proper formatting</p>
                    </div>
                    
                    <!-- Analysis Details -->
                    <div id="seo-details" class="space-y-4 hidden">
                        <!-- Keyword Analysis -->
                        <div class="p-4 bg-white bg-opacity-40 rounded-lg border border-gray-300">
                            <h4 class="font-semibold mb-2 flex items-center gap-2">
                                <span>🔑</span> Keyword Integration
                            </h4>
                            <p class="text-sm text-gray-700" id="keyword-analysis">--</p>
                        </div>
                        
                        <!-- Length Analysis -->
                        <div class="p-4 bg-white bg-opacity-40 rounded-lg border border-gray-300">
                            <h4 class="font-semibold mb-2 flex items-center gap-2">
                                <span>📏</span> Content Length
                            </h4>
                            <p class="text-sm text-gray-700" id="length-analysis">--</p>
                        </div>
                        
                        <!-- Readability -->
                        <div class="p-4 bg-white bg-opacity-40 rounded-lg border border-gray-300">
                            <h4 class="font-semibold mb-2 flex items-center gap-2">
                                <span>👁️</span> Readability
                            </h4>
                            <p class="text-sm text-gray-700" id="readability-analysis">--</p>
                        </div>
                        
                        <!-- Optimization Suggestions -->
                        <div class="p-4 bg-white bg-opacity-40 rounded-lg border border-gray-300">
                            <h4 class="font-semibold mb-3 flex items-center gap-2">
                                <span>💡</span> Top Optimization Suggestions
                            </h4>
                            <ul class="space-y-2 text-sm" id="suggestions-list">
                                <!-- Suggestions will be inserted here -->
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="seo-loading" class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-300" style="border-top-color: var(--gold);"></div>
                        <p class="mt-4 text-gray-600">Analyzing SEO performance...</p>
                    </div>
                    
                    <!-- Error State -->
                    <div id="seo-error" class="hidden text-center py-8 text-red-600">
                        <p class="font-semibold">Analysis Failed</p>
                        <p class="text-sm mt-2">Unable to analyze content. Please try again.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Collections Modal -->
        <div id="collections-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg max-w-5xl w-full max-h-[85vh] overflow-hidden" style="background-color: var(--cream);">
                <div class="p-6 border-b border-gray-300">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-semibold" style="font-family: 'Playfair Display', serif;">Curated Collections</h3>
                            <p class="text-sm text-gray-600 mt-1">Click any fragrance to auto-populate the storyteller</p>
                        </div>
                        <button id="close-collections-modal" class="text-2xl hover:text-gray-600">&times;</button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto max-h-[70vh]">
                    <!-- Best Niche Fragrances Collection -->
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">
                            Best Niche Fragrances
                        </h4>
                        <p class="text-sm text-gray-600 mb-4">Explore our curated selection of the finest niche perfumes. Click any fragrance to auto-generate its story with Aura Intelligence.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Fragrance Cards -->
                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Bianco Latte by Giardini di Toscana"
                                 data-vibe="Creamy, comforting, gourmand"
                                 data-audience="Those who seek warmth and indulgence"
                                 data-scene="A sun-drenched Italian terrace, espresso and dolce vita"
                                 data-notes="Top: Milk, Coffee; Heart: White Musk; Base: Vanilla, Sandalwood">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Bianco Latte</h5>
                                    <p class="text-xs text-gray-500 mb-3">Giardini di Toscana</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Milky indulgence</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Layton by Parfums de Marly"
                                 data-vibe="Refined, sophisticated, timeless"
                                 data-audience="Modern royalty with classic taste"
                                 data-scene="A private club in Mayfair, leather and wood paneling"
                                 data-notes="Top: Apple, Lavender, Bergamot; Heart: Geranium, Violet; Base: Vanilla, Cardamom, Sandalwood, Pepper">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Layton</h5>
                                    <p class="text-xs text-gray-500 mb-3">Parfums de Marly</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Regal elegance</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Blanche Bête by Liquides Imaginaires"
                                 data-vibe="Ethereal, animalic, mysterious"
                                 data-audience="Avant-garde souls who embrace contrast"
                                 data-scene="A moonlit forest where civilization meets wild"
                                 data-notes="Top: Aldehydes, Bergamot; Heart: Iris, Magnolia; Base: Musk, Sandalwood, Ambergris">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Blanche Bête</h5>
                                    <p class="text-xs text-gray-500 mb-3">Liquides Imaginaires</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Poetic wildness</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="1861 Naxos by Xerjoff"
                                 data-vibe="Rich, honeyed, Mediterranean"
                                 data-audience="Connoisseurs of liquid luxury"
                                 data-scene="A Sicilian citrus grove at golden hour"
                                 data-notes="Top: Bergamot, Lemon, Lavender; Heart: Honey, Cinnamon, Jasmine; Base: Tobacco, Vanilla, Tonka Bean">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">1861 Naxos</h5>
                                    <p class="text-xs text-gray-500 mb-3">Xerjoff</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Honeyed tobacco</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Alexandria II by Xerjoff"
                                 data-vibe="Opulent, spicy, oriental"
                                 data-audience="Those who appreciate historical grandeur"
                                 data-scene="An ancient library in Alexandria, scrolls and spices"
                                 data-notes="Top: Lavender, Rosemary, Apple; Heart: Cedar, Lily of the Valley; Base: Vanilla, Musk, Ambergris, Oakmoss">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Alexandria II</h5>
                                    <p class="text-xs text-gray-500 mb-3">Xerjoff</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Ancient luxury</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Angels' Share by By Kilian"
                                 data-vibe="Boozy, warm, intoxicating"
                                 data-audience="Hedonists who savor life's pleasures"
                                 data-scene="A cognac cellar in France, oak barrels aging"
                                 data-notes="Top: Cognac, Cinnamon, Tonka Bean; Heart: Oak, Praline; Base: Vanilla, Sandalwood">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Angels' Share</h5>
                                    <p class="text-xs text-gray-500 mb-3">By Kilian</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Liquid decadence</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Black Afgano by Nasomatto"
                                 data-vibe="Dark, smoky, addictive"
                                 data-audience="Bold spirits unafraid of intensity"
                                 data-scene="A smoky underground jazz club at 3 AM"
                                 data-notes="Top: Cannabis, Green Notes; Heart: Oud, Tobacco; Base: Incense, Coffee, Wood">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Black Afgano</h5>
                                    <p class="text-xs text-gray-500 mb-3">Nasomatto</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Cult favorite</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Delina by Parfums de Marly"
                                 data-vibe="Feminine, romantic, rosy"
                                 data-audience="Modern romantics with refined taste"
                                 data-scene="A rose garden in Versailles, petals and elegance"
                                 data-notes="Top: Rhubarb, Lychee, Bergamot; Heart: Turkish Rose, Peony; Base: Vanilla, Musk, Cashmeran">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Delina</h5>
                                    <p class="text-xs text-gray-500 mb-3">Parfums de Marly</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Rose perfection</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Erba Pura by Xerjoff"
                                 data-vibe="Fruity, fresh, Mediterranean"
                                 data-audience="Joyful souls who radiate positivity"
                                 data-scene="A Sicilian fruit market, citrus and laughter"
                                 data-notes="Top: Bergamot, Orange, Lemon; Heart: Fruits, White Musk; Base: Vanilla, Amber">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Erba Pura</h5>
                                    <p class="text-xs text-gray-500 mb-3">Xerjoff</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Fruity delight</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Escentric 02 by Escentric Molecules"
                                 data-vibe="Minimalist, molecular, unique"
                                 data-audience="Perfume intellectuals and modernists"
                                 data-scene="A contemporary art gallery, clean lines and innovation"
                                 data-notes="Top: Ambroxan; Heart: Elderflower, Hedione; Base: Vetiver, Orris, Musk">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Escentric 02</h5>
                                    <p class="text-xs text-gray-500 mb-3">Escentric Molecules</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Molecular magic</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="God of Fire by Stephane Humbert Lucas 777"
                                 data-vibe="Spicy, intense, powerful"
                                 data-audience="Those who command presence"
                                 data-scene="An ancient temple, incense and mysticism"
                                 data-notes="Top: Cinnamon, Elemi, Saffron; Heart: Incense, Oud, Rose; Base: Amber, Benzoin, Labdanum">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">God of Fire</h5>
                                    <p class="text-xs text-gray-500 mb-3">Stephane Humbert Lucas 777</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Divine intensity</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Gris Charnel by bdk Parfums"
                                 data-vibe="Sensual, warm, intimate"
                                 data-audience="Romantics who embrace desire"
                                 data-scene="A candlelit bedroom, silk sheets and whispers"
                                 data-notes="Top: Fig, Cardamom, Black Tea; Heart: Iris, Tonka Bean; Base: Sandalwood, Bourbon Vanilla">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Gris Charnel</h5>
                                    <p class="text-xs text-gray-500 mb-3">bdk Parfums</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Carnal elegance</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Hacivat by Nishane"
                                 data-vibe="Fresh, woody, confident"
                                 data-audience="Modern adventurers with refined taste"
                                 data-scene="A Turkish bathhouse, marble and citrus"
                                 data-notes="Top: Pineapple, Grapefruit, Bergamot; Heart: Cedar, Patchouli; Base: Oakmoss, Woody Notes">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Hacivat</h5>
                                    <p class="text-xs text-gray-500 mb-3">Nishane</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Turkish masterpiece</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Leisure in Paradise by Simone Andreoli"
                                 data-vibe="Tropical, sunny, carefree"
                                 data-audience="Free spirits chasing eternal summer"
                                 data-scene="A Caribbean beach, coconut and sea breeze"
                                 data-notes="Top: Coconut, Frangipani, Ylang Ylang; Heart: Tiare Flower, Jasmine; Base: Vanilla, Musk, Solar Notes">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Leisure in Paradise</h5>
                                    <p class="text-xs text-gray-500 mb-3">Simone Andreoli</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Island escape</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Lune Feline by Atelier des Ors"
                                 data-vibe="Mystical, musky, seductive"
                                 data-audience="Night creatures who embrace mystery"
                                 data-scene="A moonlit Parisian rooftop, shadows and secrets"
                                 data-notes="Top: Turkish Rose, Cardamom; Heart: Tonka Bean, Benzoin; Base: Musk, Vanilla, Amber">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Lune Feline</h5>
                                    <p class="text-xs text-gray-500 mb-3">Atelier des Ors</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Feline allure</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Pacific Rock Moss by Goldfield & Banks"
                                 data-vibe="Earthy, coastal, natural"
                                 data-audience="Nature lovers seeking untamed beauty"
                                 data-scene="The Australian coast, rocks and ocean spray"
                                 data-notes="Top: Bergamot, Lemon, Mandarin; Heart: Orris, Violet; Base: Oakmoss, Patchouli, Vetiver">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Pacific Rock Moss</h5>
                                    <p class="text-xs text-gray-500 mb-3">Goldfield & Banks</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Australian treasure</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Queening by Mind Games"
                                 data-vibe="Bold, confident, regal"
                                 data-audience="Queens who know their worth"
                                 data-scene="A throne room, power and presence"
                                 data-notes="Top: Blackcurrant, Pink Pepper; Heart: Tuberose, Jasmine; Base: Vanilla, Patchouli, Sandalwood">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Queening</h5>
                                    <p class="text-xs text-gray-500 mb-3">Mind Games</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Crown yourself</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Side Effect by Initio Parfums"
                                 data-vibe="Addictive, sweet, magnetic"
                                 data-audience="Those who create obsession"
                                 data-scene="A velvet-lined speakeasy, desire and danger"
                                 data-notes="Top: Rum, Cinnamon; Heart: Tobacco, Vanilla; Base: Sandalwood, Hedione">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Side Effect</h5>
                                    <p class="text-xs text-gray-500 mb-3">Initio Parfums</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Dangerously addictive</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Tobacco Vanille by Tom Ford"
                                 data-vibe="Rich, smoky, opulent"
                                 data-audience="Sophisticated souls who appreciate classics"
                                 data-scene="A London gentleman's club, leather and tobacco"
                                 data-notes="Top: Tobacco Leaf, Spicy Notes; Heart: Vanilla, Cocoa; Base: Dried Fruits, Tonka Bean, Woody Notes">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Tobacco Vanille</h5>
                                    <p class="text-xs text-gray-500 mb-3">Tom Ford</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Iconic indulgence</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="Vibrato by Sospiro"
                                 data-vibe="Citrus, sparkling, joyful"
                                 data-audience="Optimists who radiate happiness"
                                 data-scene="An Italian opera house, champagne and celebration"
                                 data-notes="Top: Orange Blossom, Neroli, Mandarin; Heart: Vanilla, Jasmine; Base: Musk, Sandalwood">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">Vibrato</h5>
                                    <p class="text-xs text-gray-500 mb-3">Sospiro</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Effervescent joy</p>
                                </div>
                            </div>

                            <div class="fragrance-card cursor-pointer p-5 rounded-lg bg-white border border-gray-200 hover:border-gold transition-all hover:shadow-xl" 
                                 data-fragrance="You Or Someone Like You by Etat Libre d'Orange"
                                 data-vibe="Clean, fresh, literary"
                                 data-audience="Intellectuals with poetic hearts"
                                 data-scene="A Los Angeles bookstore, sunlight and pages"
                                 data-notes="Top: Mint, Rose; Heart: Neroli, Hedione; Base: Musk, Cedar">
                                <div class="border-l-2 border-gold pl-4">
                                    <h5 class="font-semibold text-lg mb-1" style="font-family: 'Playfair Display', serif;">You Or Someone Like You</h5>
                                    <p class="text-xs text-gray-500 mb-3">Etat Libre d'Orange</p>
                                    <p class="text-xs italic" style="color: var(--gold);">Literary elegance</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- More Collections Coming Soon -->
                        <div class="mt-8 p-6 rounded-lg border-2 border-dashed" style="border-color: var(--gold); background: rgba(217, 119, 6, 0.05);">
                            <div class="text-center">
                                <h5 class="text-lg font-semibold mb-2" style="font-family: 'Playfair Display', serif; color: var(--gold);">
                                    More Collections Coming Soon
                                </h5>
                                <p class="text-sm text-gray-600 mb-3">
                                    We're curating new fragrance collections to inspire your next Aura story.
                                </p>
                                <div class="flex flex-wrap justify-center gap-2 text-xs text-gray-500">
                                    <span class="px-3 py-1 rounded-full bg-white border border-gray-200">🌸 Seasonal Favorites</span>
                                    <span class="px-3 py-1 rounded-full bg-white border border-gray-200">🔥 Trending Now</span>
                                    <span class="px-3 py-1 rounded-full bg-white border border-gray-200">💎 Hidden Gems</span>
                                    <span class="px-3 py-1 rounded-full bg-white border border-gray-200">🎭 By Occasion</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View Saved Stories Button -->
        <div class="fixed bottom-6 right-6" style="z-index: 999;">
            <button id="view-saved-btn" class="btn btn-gold py-3 px-6 rounded-full shadow-lg inline-flex items-center gap-2">
                <span>My Stories (<span id="saved-count">0</span>)</span>
            </button>
        </div>
    </div>
    
    <script>
    // DEFINITIVE JAVASCRIPT FIX - REWRITTEN FOR STABILITY AND CORRECTNESS
    document.addEventListener('DOMContentLoaded', function () {
        const storytellerBtn = document.getElementById('mode-storyteller');
        const curatorBtn = document.getElementById('mode-curator');
        const storytellerWrapper = document.getElementById('storyteller-wrapper');
        const curatorWrapper = document.getElementById('curator-wrapper');
        const generatorForm = document.getElementById('generator-form');
        const formSections = document.querySelectorAll('.form-section');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const generateBtn = document.getElementById('generate-btn');
        const progressBar = document.getElementById('progress-bar');
        const outputContainer = document.getElementById('output-container');
        const outputContentDiv = document.getElementById('output-content');
        const startOverBtn = document.getElementById('start-over-btn');

        let currentStep = 1;
        const totalSteps = formSections.length;

        function switchMode(mode) {
            storytellerWrapper.style.display = 'none';
            curatorWrapper.style.display = 'none';
            outputContainer.classList.add('hidden');

            if (mode === 'storyteller') {
                storytellerWrapper.style.display = 'block';
                storytellerBtn.classList.add('active');
                curatorBtn.classList.remove('active');
            } else {
                curatorWrapper.style.display = 'block';
                curatorBtn.classList.add('active');
                storytellerBtn.classList.remove('active');
            }
        }

        function updateFormUI() {
            progressBar.style.width = `${totalSteps > 1 ? ((currentStep - 1) / (totalSteps - 1)) * 100 : 0}%`;
            formSections.forEach((section, index) => {
                section.classList.toggle('active', index + 1 === currentStep);
            });
            prevBtn.disabled = currentStep === 1;
            nextBtn.classList.toggle('hidden', currentStep === totalSteps);
            generateBtn.classList.toggle('hidden', currentStep !== totalSteps);
        }

        async function handleGenerate(e) {
            e.preventDefault();
            const genBtnText = generateBtn.querySelector('span');
            const spinner = generateBtn.querySelector('svg');

            genBtnText.textContent = 'Crafting...';
            spinner.classList.remove('hidden');
            generateBtn.disabled = true;

            storytellerWrapper.style.opacity = '0';
            setTimeout(() => {
                storytellerWrapper.style.display = 'none';
                outputContainer.classList.remove('hidden');
                outputContainer.style.opacity = '1';
            }, 500);

            outputContentDiv.innerHTML = '<div class="output-card"><p class="text-gray-500 animate-pulse">Aura is consulting the muses...</p></div>';

            try {
                const response = await fetch('/generate', { method: 'POST', body: new FormData(generatorForm) });
                if (!response.ok || !response.body) throw new Error(`Server error: ${response.status}`);
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = '';
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    fullResponse += decoder.decode(value, { stream: true });
                }
                
                if (!fullResponse.trim()) throw new Error("Received empty response.");
                
                const sections = fullResponse.split('###').filter(s => s.trim());
                let html = '';
                if (sections.length > 0) {
                    sections.forEach(s => {
                        const lines = s.trim().split('\n');
                        const title = lines.shift().trim();
                        const content = lines.join('\n').trim();
                        html += `<div class="output-card"><h3>${title}</h3><div class="prose-custom">${marked.parse(content)}</div></div>`;
                    });
                } else {
                    html = `<div class="output-card"><div class="prose-custom">${marked.parse(fullResponse)}</div></div>`;
                }
                outputContentDiv.innerHTML = html;

            } catch (error) {
                console.error('Generate Error:', error);
                outputContentDiv.innerHTML = `<div class="output-card"><h3>Error</h3><p class="text-red-700"><strong>An error occurred.</strong> Please check server logs and API key.</p></div>`;
            } finally {
                genBtnText.textContent = 'Craft Story';
                spinner.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        storytellerBtn.addEventListener('click', () => switchMode('storyteller'));
        curatorBtn.addEventListener('click', () => switchMode('curator'));
        nextBtn.addEventListener('click', () => { if (currentStep < totalSteps) { currentStep++; updateFormUI(); }});
        prevBtn.addEventListener('click', () => { if (currentStep > 1) { currentStep--; updateFormUI(); }});
        generatorForm.addEventListener('submit', handleGenerate);
        startOverBtn.addEventListener('click', () => {
            outputContainer.style.opacity = '0';
            setTimeout(() => {
                outputContainer.classList.add('hidden');
                storytellerWrapper.style.display = 'block';
                storytellerWrapper.style.opacity = '1';
                generatorForm.reset();
                currentStep = 1;
                updateFormUI();
            }, 500);
        });

        // CURATOR CHAT FUNCTIONALITY
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatHistory = document.getElementById('chat-history');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');
        let conversationHistory = [];

        async function sendChatMessage(message) {
            if (!message.trim()) return;

            // Add user message to UI
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble user';
            userBubble.textContent = message;
            chatHistory.appendChild(userBubble);
            chatHistory.scrollTop = chatHistory.scrollHeight;

            // Add to conversation history
            conversationHistory.push({ role: 'user', content: message });

            // Show typing indicator
            const typingBubble = document.createElement('div');
            typingBubble.className = 'chat-bubble ai';
            typingBubble.innerHTML = '<p class="text-gray-500 animate-pulse">Aura is thinking...</p>';
            typingBubble.id = 'typing-indicator';
            chatHistory.appendChild(typingBubble);
            chatHistory.scrollTop = chatHistory.scrollHeight;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        history: conversationHistory
                    })
                });

                const data = await response.json();
                
                // Remove typing indicator
                document.getElementById('typing-indicator')?.remove();

                if (data.success && data.response) {
                    // Add AI response to UI
                    const aiBubble = document.createElement('div');
                    aiBubble.className = 'chat-bubble ai';
                    aiBubble.innerHTML = marked.parse(data.response);
                    chatHistory.appendChild(aiBubble);

                    // Add to conversation history
                    conversationHistory.push({ role: 'assistant', content: data.response });
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('typing-indicator')?.remove();
                
                const errorBubble = document.createElement('div');
                errorBubble.className = 'chat-bubble ai';
                errorBubble.innerHTML = '<p class="text-red-700">Sorry, I encountered an error. Please try again.</p>';
                chatHistory.appendChild(errorBubble);
            }

            chatHistory.scrollTop = chatHistory.scrollHeight;
            chatInput.value = '';
        }

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            sendChatMessage(chatInput.value);
        });

        suggestionChips.forEach(chip => {
            chip.addEventListener('click', () => {
                sendChatMessage(chip.dataset.suggestion);
            });
        });

        // COPY TO CLIPBOARD FUNCTIONALITY
        const copyBtn = document.getElementById('copy-btn');
        const copyBtnText = document.getElementById('copy-btn-text');
        const copyBtnIcon = document.getElementById('copy-btn-icon');

        copyBtn.addEventListener('click', async () => {
            try {
                // Get all the text from output
                const content = outputContentDiv.innerText;
                
                // Copy to clipboard
                await navigator.clipboard.writeText(content);
                
                // Visual feedback
                copyBtnIcon.textContent = '✅';
                copyBtnText.textContent = 'Copied!';
                copyBtn.classList.remove('btn-outline');
                copyBtn.classList.add('btn-gold');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    copyBtnIcon.textContent = '📋';
                    copyBtnText.textContent = 'Copy';
                    copyBtn.classList.add('btn-outline');
                    copyBtn.classList.remove('btn-gold');
                }, 2000);
            } catch (error) {
                console.error('Copy failed:', error);
                copyBtnText.textContent = 'Failed';
                setTimeout(() => {
                    copyBtnText.textContent = 'Copy';
                }, 2000);
            }
        });

        // SAVE & HISTORY FUNCTIONALITY
        const saveBtn = document.getElementById('save-btn');
        const saveBtnText = document.getElementById('save-btn-text');
        const viewSavedBtn = document.getElementById('view-saved-btn');
        const savedModal = document.getElementById('saved-stories-modal');
        const closeModal = document.getElementById('close-modal');
        const savedStoriesList = document.getElementById('saved-stories-list');
        const savedCount = document.getElementById('saved-count');

        let currentFragranceName = '';
        let currentStoryContent = '';

        // Load saved count on page load
        function updateSavedCount() {
            const saved = JSON.parse(localStorage.getItem('savedStories') || '[]');
            savedCount.textContent = saved.length;
        }
        updateSavedCount();

        // Save story
        saveBtn.addEventListener('click', () => {
            const fragranceName = document.querySelector('input[name="product_name"]').value || 'Untitled Fragrance';
            const storyContent = outputContentDiv.innerHTML;
            
            const story = {
                id: Date.now(),
                name: fragranceName,
                content: storyContent,
                date: new Date().toLocaleString(),
                preview: outputContentDiv.innerText.substring(0, 150) + '...'
            };

            // Get existing stories
            const saved = JSON.parse(localStorage.getItem('savedStories') || '[]');
            saved.unshift(story); // Add to beginning
            
            // Keep only last 50 stories
            if (saved.length > 50) saved.pop();
            
            localStorage.setItem('savedStories', JSON.stringify(saved));
            
            // Visual feedback
            saveBtnText.textContent = 'Saved! ✅';
            setTimeout(() => {
                saveBtnText.textContent = 'Save';
            }, 2000);
            
            updateSavedCount();
        });

        // View saved stories
        viewSavedBtn.addEventListener('click', () => {
            loadSavedStories();
            savedModal.classList.remove('hidden');
            savedModal.classList.add('flex');
        });

        closeModal.addEventListener('click', () => {
            savedModal.classList.add('hidden');
            savedModal.classList.remove('flex');
        });

        // Click outside modal to close
        savedModal.addEventListener('click', (e) => {
            if (e.target === savedModal) {
                savedModal.classList.add('hidden');
                savedModal.classList.remove('flex');
            }
        });

        function loadSavedStories() {
            const saved = JSON.parse(localStorage.getItem('savedStories') || '[]');
            
            if (saved.length === 0) {
                savedStoriesList.innerHTML = '<p class="text-center text-gray-500">No saved stories yet. Generate and save your first fragrance story!</p>';
                return;
            }

            savedStoriesList.innerHTML = saved.map(story => `
                <div class="mb-4 p-4 border border-gray-300 rounded-lg bg-white bg-opacity-40" style="border-color: var(--light-gray);">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="text-xl font-semibold" style="font-family: 'Playfair Display', serif;">${story.name}</h4>
                            <p class="text-sm text-gray-500">${story.date}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="loadStory(${story.id})" class="btn btn-outline py-1 px-3 text-xs">View</button>
                            <button onclick="deleteStory(${story.id})" class="btn btn-outline py-1 px-3 text-xs text-red-600">Delete</button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600">${story.preview}</p>
                </div>
            `).join('');
        }

        // Global functions for story actions
        window.loadStory = function(id) {
            const saved = JSON.parse(localStorage.getItem('savedStories') || '[]');
            const story = saved.find(s => s.id === id);
            
            if (story) {
                outputContentDiv.innerHTML = story.content;
                outputContainer.classList.remove('hidden');
                storytellerWrapper.style.display = 'none';
                savedModal.classList.add('hidden');
                savedModal.classList.remove('flex');
            }
        };

        window.deleteStory = function(id) {
            if (confirm('Are you sure you want to delete this story?')) {
                let saved = JSON.parse(localStorage.getItem('savedStories') || '[]');
                saved = saved.filter(s => s.id !== id);
                localStorage.setItem('savedStories', JSON.stringify(saved));
                loadSavedStories();
                updateSavedCount();
            }
        };

        // PDF EXPORT FUNCTIONALITY
        const pdfBtn = document.getElementById('pdf-btn');
        const pdfBtnText = document.getElementById('pdf-btn-text');

        pdfBtn.addEventListener('click', async () => {
            try {
                const fragranceName = document.querySelector('input[name="product_name"]').value || 'Fragrance Story';
                const content = outputContentDiv.innerText;
                
                pdfBtnText.textContent = 'Generating...';
                pdfBtn.disabled = true;
                
                const response = await fetch('/export-pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: fragranceName,
                        content: content
                    })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${fragranceName.replace(/\s+/g, '_')}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    pdfBtnText.textContent = 'Downloaded! ✅';
                } else {
                    throw new Error('PDF generation failed');
                }
            } catch (error) {
                console.error('PDF export error:', error);
                pdfBtnText.textContent = 'Failed ❌';
            } finally {
                setTimeout(() => {
                    pdfBtnText.textContent = 'Export PDF';
                    pdfBtn.disabled = false;
                }, 2000);
            }
        });

        // SOCIAL MEDIA FUNCTIONALITY
        const socialBtn = document.getElementById('social-btn');
        const socialModal = document.getElementById('social-modal');
        const closeSocialModal = document.getElementById('close-social-modal');
        const socialPlatformBtns = document.querySelectorAll('.social-platform-btn');
        const generateSocialBtn = document.getElementById('generate-social-btn');
        const copySocialBtn = document.getElementById('copy-social-btn');
        const socialContentDiv = document.getElementById('social-content');
        
        let currentPlatform = 'instagram';
        let currentSocialPost = '';

        socialBtn.addEventListener('click', () => {
            socialModal.classList.remove('hidden');
            socialModal.classList.add('flex');
        });

        closeSocialModal.addEventListener('click', () => {
            socialModal.classList.add('hidden');
            socialModal.classList.remove('flex');
        });

        socialModal.addEventListener('click', (e) => {
            if (e.target === socialModal) {
                socialModal.classList.add('hidden');
                socialModal.classList.remove('flex');
            }
        });

        socialPlatformBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                socialPlatformBtns.forEach(b => {
                    b.classList.remove('active', 'btn-gold');
                    b.classList.add('btn-outline');
                });
                btn.classList.add('active', 'btn-gold');
                btn.classList.remove('btn-outline');
                currentPlatform = btn.dataset.platform;
                socialContentDiv.innerHTML = '<p class="text-gray-500 text-center">Click "Generate Post" to create content</p>';
                copySocialBtn.classList.add('hidden');
            });
        });

        generateSocialBtn.addEventListener('click', async () => {
            try {
                const fragranceName = document.querySelector('input[name="product_name"]').value || 'This Fragrance';
                const content = outputContentDiv.innerText;
                
                generateSocialBtn.textContent = 'Generating...';
                generateSocialBtn.disabled = true;
                socialContentDiv.innerHTML = '<p class="text-gray-500 text-center animate-pulse">Crafting the perfect post...</p>';
                
                const response = await fetch('/social-media', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: fragranceName,
                        content: content,
                        platform: currentPlatform
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentSocialPost = data.content;
                    socialContentDiv.innerHTML = `<p class="whitespace-pre-wrap">${data.content}</p>`;
                    copySocialBtn.classList.remove('hidden');
                } else {
                    throw new Error(data.error || 'Failed to generate post');
                }
            } catch (error) {
                console.error('Social media generation error:', error);
                socialContentDiv.innerHTML = '<p class="text-red-700">Error generating post. Please try again.</p>';
            } finally {
                generateSocialBtn.textContent = 'Generate Post';
                generateSocialBtn.disabled = false;
            }
        });

        copySocialBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(currentSocialPost);
                copySocialBtn.textContent = 'Copied! ✅';
                setTimeout(() => {
                    copySocialBtn.textContent = 'Copy Post';
                }, 2000);
            } catch (error) {
                console.error('Copy failed:', error);
            }
        });

        // SEO ANALYSIS FUNCTIONALITY
        const seoBtn = document.getElementById('seo-btn');
        const seoModal = document.getElementById('seo-modal');
        const closeSeoModal = document.getElementById('close-seo-modal');
        const seoScoreValue = document.getElementById('seo-score-value');
        const seoScoreLabel = document.getElementById('seo-score-label');
        const seoScoreDesc = document.getElementById('seo-score-desc');
        const seoScoreCircle = document.getElementById('seo-score-circle');
        const seoDetails = document.getElementById('seo-details');
        const seoLoading = document.getElementById('seo-loading');
        const seoError = document.getElementById('seo-error');
        const seoBtnText = document.getElementById('seo-btn-text');
        const wordCountBadge = document.getElementById('word-count-badge');
        const optimizeSection = document.getElementById('optimize-section');
        const autoOptimizeBtn = document.getElementById('auto-optimize-btn');
        const optimizeBtnText = document.getElementById('optimize-btn-text');

        seoBtn.addEventListener('click', async () => {
            // Show modal
            seoModal.classList.remove('hidden');
            seoModal.classList.add('flex');
            
            // Reset to loading state
            seoLoading.classList.remove('hidden');
            seoDetails.classList.add('hidden');
            seoError.classList.add('hidden');
            optimizeSection.classList.add('hidden');
            seoScoreValue.textContent = '--';
            seoScoreLabel.textContent = 'Analyzing...';
            seoScoreDesc.textContent = 'Please wait while we analyze your content';
            wordCountBadge.textContent = '--';
            
            try {
                const fragranceName = document.querySelector('input[name="product_name"]').value || 'Fragrance';
                const content = outputContentDiv.innerText;
                const keywords = document.querySelector('input[name="seo_keywords"]').value || '';
                
                seoBtnText.textContent = 'Analyzing...';
                seoBtn.disabled = true;
                
                const response = await fetch('/seo-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: fragranceName,
                        content: content,
                        keywords: keywords
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const analysis = data.analysis;
                    
                    // Hide loading, show details
                    seoLoading.classList.add('hidden');
                    seoDetails.classList.remove('hidden');
                    
                    // Update score
                    const score = analysis.score || 75;
                    seoScoreValue.textContent = score;
                    
                    // Update word count
                    const wordCount = analysis.word_count || content.split(/\s+/).length;
                    wordCountBadge.textContent = wordCount;
                    
                    // Color-code word count
                    if (wordCount >= 300 && wordCount <= 500) {
                        wordCountBadge.style.color = '#10b981'; // green
                    } else if (wordCount < 300 || wordCount <= 600) {
                        wordCountBadge.style.color = '#f59e0b'; // orange
                    } else {
                        wordCountBadge.style.color = '#ef4444'; // red
                    }
                    
                    // Show optimize button if score is low or word count is off
                    if (score < 85 || wordCount < 300 || wordCount > 600) {
                        optimizeSection.classList.remove('hidden');
                    }
                    
                    // Set score color based on value
                    let scoreColor = '#C9B896'; // gold (default)
                    let scoreLabel = 'Good SEO Performance';
                    let scoreDesc = 'Your content is well-optimized for search engines';
                    
                    if (score >= 90) {
                        scoreColor = '#10b981'; // green
                        scoreLabel = 'Excellent SEO!';
                        scoreDesc = 'Outstanding optimization - ready to rank!';
                    } else if (score >= 75) {
                        scoreColor = '#C9B896'; // gold
                        scoreLabel = 'Good SEO Performance';
                        scoreDesc = 'Well-optimized with room for improvement';
                    } else if (score >= 60) {
                        scoreColor = '#f59e0b'; // orange
                        scoreLabel = 'Fair SEO Performance';
                        scoreDesc = 'Decent optimization but needs work';
                    } else {
                        scoreColor = '#ef4444'; // red
                        scoreLabel = 'Needs Improvement';
                        scoreDesc = 'Significant SEO optimization required';
                    }
                    
                    seoScoreCircle.style.borderColor = scoreColor;
                    seoScoreValue.style.color = scoreColor;
                    seoScoreLabel.textContent = scoreLabel;
                    seoScoreDesc.textContent = scoreDesc;
                    
                    // Update analysis sections
                    document.getElementById('keyword-analysis').textContent = 
                        analysis.keyword_analysis || 'Keywords are naturally integrated throughout the content.';
                    
                    document.getElementById('length-analysis').textContent = 
                        analysis.length_analysis || 'Content length is within optimal range for SEO.';
                    
                    document.getElementById('readability-analysis').textContent = 
                        analysis.readability || 'Content is engaging and easy to scan.';
                    
                    // Update suggestions
                    const suggestionsList = document.getElementById('suggestions-list');
                    suggestionsList.innerHTML = '';
                    
                    const suggestions = analysis.suggestions || ['Continue creating quality content', 'Monitor performance metrics', 'Keep content updated'];
                    suggestions.forEach((suggestion, index) => {
                        const li = document.createElement('li');
                        li.className = 'flex items-start gap-2';
                        li.innerHTML = `
                            <span class="font-semibold text-gray-700">${index + 1}.</span>
                            <span class="text-gray-700">${suggestion}</span>
                        `;
                        suggestionsList.appendChild(li);
                    });
                    
                    // If raw_analysis exists (fallback mode), show it
                    if (analysis.raw_analysis) {
                        const rawDiv = document.createElement('div');
                        rawDiv.className = 'mt-4 p-4 bg-gray-100 rounded text-sm text-gray-700';
                        rawDiv.innerHTML = `<strong>Detailed Analysis:</strong><br>${analysis.raw_analysis.replace(/\n/g, '<br>')}`;
                        seoDetails.appendChild(rawDiv);
                    }
                    
                } else {
                    throw new Error(data.error || 'Analysis failed');
                }
            } catch (error) {
                console.error('SEO analysis error:', error);
                seoLoading.classList.add('hidden');
                seoError.classList.remove('hidden');
            } finally {
                seoBtnText.textContent = 'SEO Score';
                seoBtn.disabled = false;
            }
        });

        // AUTO-OPTIMIZE FUNCTIONALITY
        autoOptimizeBtn.addEventListener('click', async () => {
            try {
                const fragranceName = document.querySelector('input[name="product_name"]').value || 'Fragrance';
                const content = outputContentDiv.innerText;
                const keywords = document.querySelector('input[name="seo_keywords"]').value || '';
                
                optimizeBtnText.textContent = 'Optimizing...';
                autoOptimizeBtn.disabled = true;
                
                const response = await fetch('/optimize-seo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: fragranceName,
                        content: content,
                        keywords: keywords
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Replace content with optimized version
                    outputContentDiv.innerHTML = marked.parse(data.optimized_content);
                    
                    // Close modal and show success message
                    seoModal.classList.add('hidden');
                    seoModal.classList.remove('flex');
                    
                    // Show notification
                    optimizeBtnText.textContent = 'Optimized! ✅';
                    
                    // Scroll to output
                    outputContainer.scrollIntoView({ behavior: 'smooth' });
                    
                    setTimeout(() => {
                        optimizeBtnText.textContent = 'Auto-Optimize for SEO';
                    }, 3000);
                } else {
                    throw new Error(data.error || 'Optimization failed');
                }
            } catch (error) {
                console.error('Optimization error:', error);
                optimizeBtnText.textContent = 'Failed ❌';
                setTimeout(() => {
                    optimizeBtnText.textContent = 'Auto-Optimize for SEO';
                }, 3000);
            } finally {
                autoOptimizeBtn.disabled = false;
            }
        });

        closeSeoModal.addEventListener('click', () => {
            seoModal.classList.add('hidden');
            seoModal.classList.remove('flex');
        });

        seoModal.addEventListener('click', (e) => {
            if (e.target === seoModal) {
                seoModal.classList.add('hidden');
                seoModal.classList.remove('flex');
            }
        });

        // COLLECTIONS FUNCTIONALITY
        const browseCollectionsBtn = document.getElementById('browse-collections-btn');
        const collectionsModal = document.getElementById('collections-modal');
        const closeCollectionsModal = document.getElementById('close-collections-modal');
        const fragranceCards = document.querySelectorAll('.fragrance-card');

        browseCollectionsBtn.addEventListener('click', () => {
            collectionsModal.classList.remove('hidden');
            collectionsModal.classList.add('flex');
        });

        closeCollectionsModal.addEventListener('click', () => {
            collectionsModal.classList.add('hidden');
            collectionsModal.classList.remove('flex');
        });

        collectionsModal.addEventListener('click', (e) => {
            if (e.target === collectionsModal) {
                collectionsModal.classList.add('hidden');
                collectionsModal.classList.remove('flex');
            }
        });

        // Auto-populate form when fragrance card is clicked
        fragranceCards.forEach(card => {
            card.addEventListener('click', () => {
                const fragranceName = card.dataset.fragrance;
                const vibe = card.dataset.vibe;
                const audience = card.dataset.audience;
                const scene = card.dataset.scene;
                const notes = card.dataset.notes || ''; // Get notes if available

                // Switch to Storyteller mode if not already
                storytellerBtn.click();

                // Select "existing fragrance" option
                document.querySelector('input[value="existing"]').checked = true;

                // Populate form fields
                document.querySelector('input[name="product_name"]').value = fragranceName;
                document.querySelector('textarea[name="key_notes"]').value = notes; // Populate notes field
                document.querySelector('input[name="vibe_keywords"]').value = vibe;
                document.querySelector('input[name="target_audience"]').value = audience;
                document.querySelector('input[name="storytelling_angle"]').value = scene;

                // Close modal
                collectionsModal.classList.add('hidden');
                collectionsModal.classList.remove('flex');

                // Reset to step 1 and show form
                currentStep = 1;
                updateFormUI();

                // Scroll to form
                storytellerWrapper.scrollIntoView({ behavior: 'smooth' });

                // Show success feedback
                const productNameInput = document.querySelector('input[name="product_name"]');
                productNameInput.style.backgroundColor = 'rgba(217, 119, 6, 0.1)';
                setTimeout(() => {
                    productNameInput.style.backgroundColor = '';
                }, 1000);
            });
        });

        // TONE PREVIEW FUNCTIONALITY
        const toneSelect = document.getElementById('tone-select');
        const tonePreview = document.getElementById('tone-preview');
        const tonePreviewText = document.getElementById('tone-preview-text');
        const tonePreviewUse = document.getElementById('tone-preview-use');

        if (toneSelect) {
            // Show preview on focus/change
            toneSelect.addEventListener('focus', updateTonePreview);
            toneSelect.addEventListener('change', updateTonePreview);
            
            // Hide preview when clicking outside
            document.addEventListener('click', (e) => {
                if (!toneSelect.contains(e.target) && !tonePreview.contains(e.target)) {
                    tonePreview.classList.add('hidden');
                }
            });

            function updateTonePreview() {
                const selectedOption = toneSelect.options[toneSelect.selectedIndex];
                const preview = selectedOption.dataset.preview;
                const use = selectedOption.dataset.use;
                
                if (preview && use) {
                    tonePreviewText.textContent = `"${preview}"`;
                    tonePreviewUse.textContent = use;
                    tonePreview.classList.remove('hidden');
                }
            }
        }

        updateFormUI(); // Initial call

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
    });
    </script>
</body>
</html>
